
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>26 Kafka设计原理详解 · 架构师学习笔记</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Tyrival">
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../../styles/website.css">
        
    

        
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="27-Kafka-Optimizer-Training.html" />
    
    
    <link rel="prev" href="25-Kafka-Cluster.html" />
    

    <style>
    @media only screen and (max-width: 640px) {
        .book-header .hidden-mobile {
            display: none;
        }
    }
    </style>
    <script>
        window["gitbook-plugin-github-buttons"] = {"buttons":[{"user":"Tyrival","repo":"gitbook","type":"star","size":"small","count":false}]};
    </script>

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    架构师学习笔记
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1" data-path="../../01-JVM/">
            
                <a href="../../01-JVM/">
            
                    
                    第1章 JVM
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1.1" data-path="../../01-JVM/01-ClassLoader.html">
            
                <a href="../../01-JVM/01-ClassLoader.html">
            
                    
                    1 类加载机制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.1.2" data-path="../../01-JVM/02-JVM-Structure-Resolve.html">
            
                <a href="../../01-JVM/02-JVM-Structure-Resolve.html">
            
                    
                    2 JVM整体结构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.1.3" data-path="../../01-JVM/03-Memory-Allocation-Mechanism.html">
            
                <a href="../../01-JVM/03-Memory-Allocation-Mechanism.html">
            
                    
                    3 JVM内存分配机制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.1.4" data-path="../../01-JVM/04-JVM-Bytecode-File-Structure.html">
            
                <a href="../../01-JVM/04-JVM-Bytecode-File-Structure.html">
            
                    
                    4 JVM字节码文件结构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.1.5" data-path="../../01-JVM/05-GC-ParNew-CMS.html">
            
                <a href="../../01-JVM/05-GC-ParNew-CMS.html">
            
                    
                    5 垃圾收集器ParNew和CMS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.1.6" data-path="../../01-JVM/06-GC-G1-ZGC.html">
            
                <a href="../../01-JVM/06-GC-G1-ZGC.html">
            
                    
                    6 垃圾收集器G1和ZGC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.1.7" data-path="../../01-JVM/07-GC-Optimize-01.html">
            
                <a href="../../01-JVM/07-GC-Optimize-01.html">
            
                    
                    7 GC调优（一）
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.1.8" data-path="../../01-JVM/08-GC-Optimize-02.html">
            
                <a href="../../01-JVM/08-GC-Optimize-02.html">
            
                    
                    8 GC调优（二）
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.1.9" data-path="../../01-JVM/JVM-Command.html">
            
                <a href="../../01-JVM/JVM-Command.html">
            
                    
                    附1 JVM指令手册
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.1.2" data-path="../../02-Tomcat/">
            
                <a href="../../02-Tomcat/">
            
                    
                    第2章 Tomcat
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.2.1" data-path="../../02-Tomcat/01-Tomcat-Summary.html">
            
                <a href="../../02-Tomcat/01-Tomcat-Summary.html">
            
                    
                    1 Tomcat生产环境应用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.2.2" data-path="../../02-Tomcat/02-Tomcat-Component-Src.html">
            
                <a href="../../02-Tomcat/02-Tomcat-Component-Src.html">
            
                    
                    2 Tomcat核心组件源码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.2.3" data-path="../../02-Tomcat/03-Tomcat-Http-Process.html">
            
                <a href="../../02-Tomcat/03-Tomcat-Http-Process.html">
            
                    
                    3 Tomcat线程模型HTTP请求处理与管道线模型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.2.4" data-path="../../02-Tomcat/04-Tomcat-Hot-Deployment-Load.html">
            
                <a href="../../02-Tomcat/04-Tomcat-Hot-Deployment-Load.html">
            
                    
                    4 Tomcat热部署和热加载
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.1.3" data-path="../../03-MySQL/">
            
                <a href="../../03-MySQL/">
            
                    
                    第3章 MySQL
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.3.1" data-path="../../03-MySQL/01-Mysql-index-data-structure.html">
            
                <a href="../../03-MySQL/01-Mysql-index-data-structure.html">
            
                    
                    1 Mysql索引数据结构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.3.2" data-path="../../03-MySQL/02-Explain-Index-Actual.html">
            
                <a href="../../03-MySQL/02-Explain-Index-Actual.html">
            
                    
                    2 Explain详解与索引最佳实践
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.3.3" data-path="../../03-MySQL/03-Sql-Execution-Fundamental.html">
            
                <a href="../../03-MySQL/03-Sql-Execution-Fundamental.html">
            
                    
                    3 SQL底层执行原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.3.4" data-path="../../03-MySQL/04-Sql-Optimize-01.html">
            
                <a href="../../03-MySQL/04-Sql-Optimize-01.html">
            
                    
                    4 SQL优化实战（一）
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.3.5" data-path="../../03-MySQL/05-Sql-Optimize-02.html">
            
                <a href="../../03-MySQL/05-Sql-Optimize-02.html">
            
                    
                    5 SQL优化实战（二）
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.3.6" data-path="../../03-MySQL/06-Mysql-Lock-Transaction-Isolation.html">
            
                <a href="../../03-MySQL/06-Mysql-Lock-Transaction-Isolation.html">
            
                    
                    6 Mysql锁与事务隔离级别
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.3.7" data-path="../../03-MySQL/Slow-Sql-Query.html">
            
                <a href="../../03-MySQL/Slow-Sql-Query.html">
            
                    
                    附1 慢SQL查询
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.3.8" data-path="../../03-MySQL/Ali-Java-Explain.html">
            
                <a href="../../03-MySQL/Ali-Java-Explain.html">
            
                    
                    附2 阿里巴巴手册（泰山版）解读-MySQL数据库
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.1.4" data-path="../../04-Concurrent/">
            
                <a href="../../04-Concurrent/">
            
                    
                    第4章 并发编程
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.4.1" data-path="../../04-Concurrent/01-JMM-JSR133.html">
            
                <a href="../../04-Concurrent/01-JMM-JSR133.html">
            
                    
                    1 并发编程之JMM & JSR133规范解读
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.4.2" data-path="../../04-Concurrent/02-JMM-Features.html">
            
                <a href="../../04-Concurrent/02-JMM-Features.html">
            
                    
                    2 并发编程之JMM三大特性详解
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.4.3" data-path="../../04-Concurrent/03-MESI-Cache-Coherency-Protocol.html">
            
                <a href="../../04-Concurrent/03-MESI-Cache-Coherency-Protocol.html">
            
                    
                    3 MESI缓存一致协议详解
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.4.4" data-path="../../04-Concurrent/04-Synchronized.html">
            
                <a href="../../04-Concurrent/04-Synchronized.html">
            
                    
                    4 并发编程之synchronized详解
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.4.5" data-path="../../04-Concurrent/05-AQS-Lock.html">
            
                <a href="../../04-Concurrent/05-AQS-Lock.html">
            
                    
                    5 抽象队列同步器AQS应用Lock详解
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.4.6" data-path="../../04-Concurrent/06-AQS-Blocking-Queue.html">
            
                <a href="../../04-Concurrent/06-AQS-Blocking-Queue.html">
            
                    
                    6 抽象队列同步器AQS应用之BlockingQueue详解
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.4.7" data-path="../../04-Concurrent/07-Tools-CountDownLatch-Semaphore.html">
            
                <a href="../../04-Concurrent/07-Tools-CountDownLatch-Semaphore.html">
            
                    
                    7 并发编程之Tools&CountDownLatch&Semaphore原理与应用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.4.8" data-path="../../04-Concurrent/08-Atomic-Unsafe-Magic-Class.html">
            
                <a href="../../04-Concurrent/08-Atomic-Unsafe-Magic-Class.html">
            
                    
                    8 并发编程之Atomic&Unsafe魔法类详解
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.4.9" data-path="../../04-Concurrent/09-Collections-Map-List-Set.html">
            
                <a href="../../04-Concurrent/09-Collections-Map-List-Set.html">
            
                    
                    9 Collections之Map&List&Set详解
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.4.10" data-path="../../04-Concurrent/10-Executor-Thread-Pool.html">
            
                <a href="../../04-Concurrent/10-Executor-Thread-Pool.html">
            
                    
                    10 Executor线程池原理与源码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.4.11" data-path="../../04-Concurrent/11-Schedule-Task-Thread-Pool.html">
            
                <a href="../../04-Concurrent/11-Schedule-Task-Thread-Pool.html">
            
                    
                    11 并发编程之定时任务&定时线程池
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.4.12" data-path="../../04-Concurrent/12-Future-ForkJoin.html">
            
                <a href="../../04-Concurrent/12-Future-ForkJoin.html">
            
                    
                    12 并发编程之Future&ForkJoin框架原理分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.4.13" data-path="../../04-Concurrent/13-Disruptor.html">
            
                <a href="../../04-Concurrent/13-Disruptor.html">
            
                    
                    13 无锁并发框架Disruptor
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.1.5" data-path="../../05-Source/">
            
                <a href="../../05-Source/">
            
                    
                    第5章 源码框架
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.5.1" data-path="../../05-Source/01-Spring-Code-Compile.html">
            
                <a href="../../05-Source/01-Spring-Code-Compile.html">
            
                    
                    1 Spring源码介绍和编译
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.5.2" data-path="../../05-Source/02-Spring-IoC.html">
            
                <a href="../../05-Source/02-Spring-IoC.html">
            
                    
                    2 Spring Ioc容器加载过程—Bean的生命周期源码深度剖析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.5.3" data-path="../../05-Source/03-Spring-Resolve-Circular-Dependencies.html">
            
                <a href="../../05-Source/03-Spring-Resolve-Circular-Dependencies.html">
            
                    
                    3 Spring如何解决循环依赖
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.5.4" data-path="../../05-Source/04-Spring-Event.html">
            
                <a href="../../05-Source/04-Spring-Event.html">
            
                    
                    4 Spring事件监听机制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.5.5" data-path="../../05-Source/05-Spring-AOP.html">
            
                <a href="../../05-Source/05-Spring-AOP.html">
            
                    
                    5 Spring AOP源码
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.1.6" data-path="../">
            
                <a href="../">
            
                    
                    第6章 分布式
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.6.1" data-path="01-Zookeeper-Node.html">
            
                <a href="01-Zookeeper-Node.html">
            
                    
                    1 Zookeeper特性与节点说明
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.6.2" data-path="05-Redis-Data-Structure.html">
            
                <a href="05-Redis-Data-Structure.html">
            
                    
                    5 Redis核心数据结构与核心原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.6.3" data-path="06-Redis-Persistent-Distributed-Mode.html">
            
                <a href="06-Redis-Persistent-Distributed-Mode.html">
            
                    
                    6 Redis持久化、主从与哨兵架构详解
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.6.4" data-path="07-Redis-Cluster-Mode.html">
            
                <a href="07-Redis-Cluster-Mode.html">
            
                    
                    7 Redis高可用集群
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.6.5" data-path="08-Redis-Distributed-Lock-Training.html">
            
                <a href="08-Redis-Distributed-Lock-Training.html">
            
                    
                    8 Redis高并发分布式锁实战
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.6.6" data-path="09-Redis-Design-Optimize.html">
            
                <a href="09-Redis-Design-Optimize.html">
            
                    
                    9 Redis缓存设计与性能优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.6.7" data-path="10-Nginx-Core-Config.html">
            
                <a href="10-Nginx-Core-Config.html">
            
                    
                    10 Nginx核心模块与配置实践
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.6.8" data-path="11-Nginx-Optimize-Training.html">
            
                <a href="11-Nginx-Optimize-Training.html">
            
                    
                    11 Nginx性能优化实践
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.6.9" data-path="12-MongoDB-Quick-Start.html">
            
                <a href="12-MongoDB-Quick-Start.html">
            
                    
                    12 MongoDB的逻辑组成
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.6.10" data-path="13-MongoDB-Cluster-Advanced-Feature.html">
            
                <a href="13-MongoDB-Cluster-Advanced-Feature.html">
            
                    
                    13 MongoDB集群架构与高级特性
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.6.11" data-path="14-MongoDB-Training.html">
            
                <a href="14-MongoDB-Training.html">
            
                    
                    14 MongoDB企业应用实战
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.6.12" data-path="15-Java-BIO-NIO-AIO.html">
            
                <a href="15-Java-BIO-NIO-AIO.html">
            
                    
                    15 Java BIO & NIO & AIO
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.6.13" data-path="16-Netty-Core-Thread-Model.html">
            
                <a href="16-Netty-Core-Thread-Model.html">
            
                    
                    16 Netty核心功能与线程模型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.6.14" data-path="17-Netty-Codec-Pack-Unpack-Zero-Copy.html">
            
                <a href="17-Netty-Codec-Pack-Unpack-Zero-Copy.html">
            
                    
                    17 Netty编解码，粘包拆包及零拷贝
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.6.15" data-path="18-Netty-Thread-Model-Source.html">
            
                <a href="18-Netty-Thread-Model-Source.html">
            
                    
                    18 Netty线程模型源码详解
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.6.16" data-path="19-Netty-Barrage-Dubbo.html">
            
                <a href="19-Netty-Barrage-Dubbo.html">
            
                    
                    19 Netty在弹幕系统与Dubbo框架中的应用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.6.17" data-path="20-RabbitMQ-Start.html">
            
                <a href="20-RabbitMQ-Start.html">
            
                    
                    20 RabbitMQ基本概念讲解
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.6.18" data-path="21-RabbitMQ-Cluster.html">
            
                <a href="21-RabbitMQ-Cluster.html">
            
                    
                    21 RabbitMQ集群及高级特性
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.6.19" data-path="22-RabbitMQ-Reliability-Message.html">
            
                <a href="22-RabbitMQ-Reliability-Message.html">
            
                    
                    22 RabbitMQ如何作可靠性消息投递
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.6.20" data-path="23-RocketMQ-Start.html">
            
                <a href="23-RocketMQ-Start.html">
            
                    
                    23 RocketMQ整体部署与快速实战
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.6.21" data-path="24-RocketMQ-Feature.html">
            
                <a href="24-RocketMQ-Feature.html">
            
                    
                    24 RocketMQ特性详解&场景介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.6.22" data-path="25-Kafka-Cluster.html">
            
                <a href="25-Kafka-Cluster.html">
            
                    
                    25 Kafka集群搭建与使用
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.1.6.23" data-path="26-Kafka-Architecture.html">
            
                <a href="26-Kafka-Architecture.html">
            
                    
                    26 Kafka设计原理详解
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.6.24" data-path="27-Kafka-Optimizer-Training.html">
            
                <a href="27-Kafka-Optimizer-Training.html">
            
                    
                    27 Kafka性能优化实战
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.1.7" data-path="../../07-Microservice/">
            
                <a href="../../07-Microservice/">
            
                    
                    第7章 微服务
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.8" data-path="../../08-Training/">
            
                <a href="../../08-Training/">
            
                    
                    第8章 实战案例
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >26 Kafka设计原理详解</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-navicon"></i><ul><li><span class="title-icon "></span><a href="#kafka&#x8BBE;&#x8BA1;&#x539F;&#x7406;&#x8BE6;&#x89E3;"><b></b>Kafka&#x8BBE;&#x8BA1;&#x539F;&#x7406;&#x8BE6;&#x89E3;</a></li><ul><li><span class="title-icon "></span><a href="#1-kafka&#x62D3;&#x6251;&#x7ED3;&#x6784;"><b></b>1. Kafka&#x62D3;&#x6251;&#x7ED3;&#x6784;</a></li><ul><li><span class="title-icon "></span><a href="#11-kafka&#x6838;&#x5FC3;&#x603B;&#x63A7;&#x5236;&#x5668;controller"><b></b>1.1 Kafka&#x6838;&#x5FC3;&#x603B;&#x63A7;&#x5236;&#x5668;Controller</a></li></ul><li><span class="title-icon "></span><a href="#12-controller&#x9009;&#x4E3E;&#x673A;&#x5236;"><b></b>1.2 Controller&#x9009;&#x4E3E;&#x673A;&#x5236;</a></li><ul><li><span class="title-icon "></span><a href="#13-partition&#x526F;&#x672C;&#x9009;&#x4E3E;leader&#x673A;&#x5236;"><b></b>1.3 Partition&#x526F;&#x672C;&#x9009;&#x4E3E;Leader&#x673A;&#x5236;</a></li><li><span class="title-icon "></span><a href="#14-&#x6D88;&#x8D39;&#x8005;&#x6D88;&#x8D39;&#x6D88;&#x606F;&#x7684;offset&#x8BB0;&#x5F55;&#x673A;&#x5236;"><b></b>1.4 &#x6D88;&#x8D39;&#x8005;&#x6D88;&#x8D39;&#x6D88;&#x606F;&#x7684;offset&#x8BB0;&#x5F55;&#x673A;&#x5236;</a></li></ul></ul><li><span class="title-icon "></span><a href="#&#x6D88;&#x8D39;&#x8005;rebalance&#x673A;&#x5236;"><b></b>&#x6D88;&#x8D39;&#x8005;Rebalance&#x673A;&#x5236;**</a></li><ul><ul><li><span class="title-icon "></span><a href="#15-rebalance"><b></b>1.5 Rebalance</a></li><li><span class="title-icon "></span><a href="#16-&#x6D88;&#x8D39;&#x8005;rebalance&#x5206;&#x533A;&#x5206;&#x914D;&#x7B56;&#x7565;"><b></b>1.6 &#x6D88;&#x8D39;&#x8005;Rebalance&#x5206;&#x533A;&#x5206;&#x914D;&#x7B56;&#x7565;</a></li></ul><li><span class="title-icon "></span><a href="#2-producer&#x53D1;&#x5E03;&#x6D88;&#x606F;&#x673A;&#x5236;&#x5256;&#x6790;"><b></b>2. producer&#x53D1;&#x5E03;&#x6D88;&#x606F;&#x673A;&#x5236;&#x5256;&#x6790;</a></li><ul><li><span class="title-icon "></span><a href="#21-&#x5199;&#x5165;&#x65B9;&#x5F0F;"><b></b>2.1 &#x5199;&#x5165;&#x65B9;&#x5F0F;</a></li><li><span class="title-icon "></span><a href="#22-&#x6D88;&#x606F;&#x8DEF;&#x7531;"><b></b>2.2 &#x6D88;&#x606F;&#x8DEF;&#x7531;</a></li><li><span class="title-icon "></span><a href="#23-&#x5199;&#x5165;&#x6D41;&#x7A0B;"><b></b>2.3 &#x5199;&#x5165;&#x6D41;&#x7A0B;</a></li></ul><li><span class="title-icon "></span><a href="#3-hw&#x4E0E;leo&#x8BE6;&#x89E3;"><b></b>3. HW&#x4E0E;LEO&#x8BE6;&#x89E3;</a></li><li><span class="title-icon "></span><a href="#4-&#x65E5;&#x5FD7;&#x5206;&#x6BB5;&#x5B58;&#x50A8;"><b></b>4. &#x65E5;&#x5FD7;&#x5206;&#x6BB5;&#x5B58;&#x50A8;</a></li><li><span class="title-icon "></span><a href="#5-zookeeper&#x8282;&#x70B9;&#x6570;&#x636E;&#x56FE;"><b></b>5. zookeeper&#x8282;&#x70B9;&#x6570;&#x636E;&#x56FE;</a></li></ul></ul></div><a href="#kafka&#x8BBE;&#x8BA1;&#x539F;&#x7406;&#x8BE6;&#x89E3;" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><h1 id="kafka&#x8BBE;&#x8BA1;&#x539F;&#x7406;&#x8BE6;&#x89E3;"><a name="kafka&#x8BBE;&#x8BA1;&#x539F;&#x7406;&#x8BE6;&#x89E3;" class="anchor-navigation-ex-anchor" href="#kafka&#x8BBE;&#x8BA1;&#x539F;&#x7406;&#x8BE6;&#x89E3;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="kafka&#x8BBE;&#x8BA1;&#x539F;&#x7406;&#x8BE6;&#x89E3;" class="plugin-anchor" href="#kafka&#x8BBE;&#x8BA1;&#x539F;&#x7406;&#x8BE6;&#x89E3;"><i class="fa fa-link" aria-hidden="true"></i></a>Kafka&#x8BBE;&#x8BA1;&#x539F;&#x7406;&#x8BE6;&#x89E3;</h1>
<h2 id="1-kafka&#x62D3;&#x6251;&#x7ED3;&#x6784;"><a name="1-kafka&#x62D3;&#x6251;&#x7ED3;&#x6784;" class="anchor-navigation-ex-anchor" href="#1-kafka&#x62D3;&#x6251;&#x7ED3;&#x6784;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="1-kafka&#x62D3;&#x6251;&#x7ED3;&#x6784;" class="plugin-anchor" href="#1-kafka&#x62D3;&#x6251;&#x7ED3;&#x6784;"><i class="fa fa-link" aria-hidden="true"></i></a>1. Kafka&#x62D3;&#x6251;&#x7ED3;&#x6784;</h2>
<p><img src="../../source/images/ch-06/old/kafka-architecture-01.png" alt="kafka-architecture-01"></p>
<h3 id="11-kafka&#x6838;&#x5FC3;&#x603B;&#x63A7;&#x5236;&#x5668;controller"><a name="11-kafka&#x6838;&#x5FC3;&#x603B;&#x63A7;&#x5236;&#x5668;controller" class="anchor-navigation-ex-anchor" href="#11-kafka&#x6838;&#x5FC3;&#x603B;&#x63A7;&#x5236;&#x5668;controller"><i class="fa fa-link" aria-hidden="true"></i></a><a name="11-kafka&#x6838;&#x5FC3;&#x603B;&#x63A7;&#x5236;&#x5668;controller" class="plugin-anchor" href="#11-kafka&#x6838;&#x5FC3;&#x603B;&#x63A7;&#x5236;&#x5668;controller"><i class="fa fa-link" aria-hidden="true"></i></a>1.1 Kafka&#x6838;&#x5FC3;&#x603B;&#x63A7;&#x5236;&#x5668;Controller</h3>
<p>&#x5728;Kafka&#x96C6;&#x7FA4;&#x4E2D;&#x4F1A;&#x6709;&#x4E00;&#x4E2A;&#x6216;&#x8005;&#x591A;&#x4E2A;broker&#xFF0C;&#x5176;&#x4E2D;&#x6709;&#x4E00;&#x4E2A;broker&#x4F1A;&#x88AB;&#x9009;&#x4E3E;&#x4E3A;&#x63A7;&#x5236;&#x5668;&#xFF08;Kafka Controller&#xFF09;&#xFF0C;&#x5B83;&#x8D1F;&#x8D23;&#x7BA1;&#x7406;&#x6574;&#x4E2A;&#x96C6;&#x7FA4;&#x4E2D;&#x6240;&#x6709;&#x5206;&#x533A;&#x548C;&#x526F;&#x672C;&#x7684;&#x72B6;&#x6001;&#x3002;</p>
<ul>
<li>&#x5F53;&#x67D0;&#x4E2A;&#x5206;&#x533A;&#x7684;leader&#x526F;&#x672C;&#x51FA;&#x73B0;&#x6545;&#x969C;&#x65F6;&#xFF0C;&#x7531;&#x63A7;&#x5236;&#x5668;&#x8D1F;&#x8D23;&#x4E3A;&#x8BE5;&#x5206;&#x533A;&#x9009;&#x4E3E;&#x65B0;&#x7684;leader&#x526F;&#x672C;&#x3002;</li>
<li>&#x5F53;&#x68C0;&#x6D4B;&#x5230;&#x67D0;&#x4E2A;&#x5206;&#x533A;&#x7684;ISR&#x96C6;&#x5408;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x65F6;&#xFF0C;&#x7531;&#x63A7;&#x5236;&#x5668;&#x8D1F;&#x8D23;&#x901A;&#x77E5;&#x6240;&#x6709;broker&#x66F4;&#x65B0;&#x5176;&#x5143;&#x6570;&#x636E;&#x4FE1;&#x606F;&#x3002;</li>
<li>&#x5F53;&#x4F7F;&#x7528;kafka-topics.sh&#x811A;&#x672C;&#x4E3A;&#x67D0;&#x4E2A;topic&#x589E;&#x52A0;&#x5206;&#x533A;&#x6570;&#x91CF;&#x65F6;&#xFF0C;&#x540C;&#x6837;&#x8FD8;&#x662F;&#x7531;&#x63A7;&#x5236;&#x5668;&#x8D1F;&#x8D23;&#x8BA9;&#x65B0;&#x5206;&#x533A;&#x88AB;&#x5176;&#x4ED6;&#x8282;&#x70B9;&#x611F;&#x77E5;&#x5230;&#x3002;</li>
</ul>
<h2 id="12-controller&#x9009;&#x4E3E;&#x673A;&#x5236;"><a name="12-controller&#x9009;&#x4E3E;&#x673A;&#x5236;" class="anchor-navigation-ex-anchor" href="#12-controller&#x9009;&#x4E3E;&#x673A;&#x5236;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="12-controller&#x9009;&#x4E3E;&#x673A;&#x5236;" class="plugin-anchor" href="#12-controller&#x9009;&#x4E3E;&#x673A;&#x5236;"><i class="fa fa-link" aria-hidden="true"></i></a>1.2 Controller&#x9009;&#x4E3E;&#x673A;&#x5236;</h2>
<p>&#x5728;kafka&#x96C6;&#x7FA4;&#x542F;&#x52A8;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x81EA;&#x52A8;&#x9009;&#x4E3E;&#x4E00;&#x53F0;broker&#x4F5C;&#x4E3A;controller&#x6765;&#x7BA1;&#x7406;&#x6574;&#x4E2A;&#x96C6;&#x7FA4;&#xFF0C;&#x9009;&#x4E3E;&#x7684;&#x8FC7;&#x7A0B;&#x662F;&#x96C6;&#x7FA4;&#x4E2D;&#x6BCF;&#x4E2A;broker&#x90FD;&#x4F1A;&#x5C1D;&#x8BD5;&#x5728;zookeeper&#x4E0A;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; <strong>/controller &#x4E34;&#x65F6;&#x8282;&#x70B9;</strong>&#xFF0C;zookeeper&#x4F1A;&#x4FDD;&#x8BC1;&#x6709;&#x4E14;&#x4EC5;&#x6709;&#x4E00;&#x4E2A;broker&#x80FD;&#x521B;&#x5EFA;&#x6210;&#x529F;&#xFF0C;&#x8FD9;&#x4E2A;broker&#x5C31;&#x4F1A;&#x6210;&#x4E3A;&#x96C6;&#x7FA4;&#x7684;&#x603B;&#x63A7;&#x5668;controller&#x3002;</p>
<p> &#x5F53;&#x8FD9;&#x4E2A;controller&#x89D2;&#x8272;&#x7684;broker&#x5B95;&#x673A;&#x4E86;&#xFF0C;&#x6B64;&#x65F6;zookeeper&#x4E34;&#x65F6;&#x8282;&#x70B9;&#x4F1A;&#x6D88;&#x5931;&#xFF0C;&#x96C6;&#x7FA4;&#x91CC;&#x5176;&#x4ED6;broker&#x4F1A;&#x4E00;&#x76F4;&#x76D1;&#x542C;&#x8FD9;&#x4E2A;&#x4E34;&#x65F6;&#x8282;&#x70B9;&#xFF0C;&#x53D1;&#x73B0;&#x4E34;&#x65F6;&#x8282;&#x70B9;&#x6D88;&#x5931;&#x4E86;&#xFF0C;&#x5C31;&#x7ADE;&#x4E89;&#x518D;&#x6B21;&#x521B;&#x5EFA;&#x4E34;&#x65F6;&#x8282;&#x70B9;&#xFF0C;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x4E0A;&#x9762;&#x8BF4;&#x7684;&#x9009;&#x4E3E;&#x673A;&#x5236;&#xFF0C;zookeeper&#x53C8;&#x4F1A;&#x4FDD;&#x8BC1;&#x6709;&#x4E00;&#x4E2A;broker&#x6210;&#x4E3A;&#x65B0;&#x7684;controller&#x3002;</p>
<p>&#x5177;&#x5907;&#x63A7;&#x5236;&#x5668;&#x8EAB;&#x4EFD;&#x7684;broker&#x9700;&#x8981;&#x6BD4;&#x5176;&#x4ED6;&#x666E;&#x901A;&#x7684;broker&#x591A;&#x4E00;&#x4EFD;&#x804C;&#x8D23;&#xFF0C;&#x5177;&#x4F53;&#x7EC6;&#x8282;&#x5982;&#x4E0B;&#xFF1A;</p>
<ol>
<li><strong>&#x76D1;&#x542C;broker&#x76F8;&#x5173;&#x7684;&#x53D8;&#x5316;</strong>&#x3002;&#x4E3A;Zookeeper&#x4E2D;&#x7684;/brokers/ids/&#x8282;&#x70B9;&#x6DFB;&#x52A0;BrokerChangeListener&#xFF0C;&#x7528;&#x6765;&#x5904;&#x7406;broker&#x589E;&#x51CF;&#x7684;&#x53D8;&#x5316;&#x3002;</li>
<li>&#x76D1;&#x542C;topic&#x76F8;&#x5173;&#x7684;&#x53D8;&#x5316;&#x3002;&#x4E3A;Zookeeper&#x4E2D;&#x7684;/brokers/topics&#x8282;&#x70B9;&#x6DFB;&#x52A0;TopicChangeListener&#xFF0C;&#x7528;&#x6765;&#x5904;&#x7406;topic&#x589E;&#x51CF;&#x7684;&#x53D8;&#x5316;&#xFF1B;&#x4E3A;Zookeeper&#x4E2D;&#x7684;/admin/delete_topics&#x8282;&#x70B9;&#x6DFB;&#x52A0;TopicDeletionListener&#xFF0C;&#x7528;&#x6765;&#x5904;&#x7406;&#x5220;&#x9664;topic&#x7684;&#x52A8;&#x4F5C;&#x3002;</li>
<li>&#x4ECE;Zookeeper&#x4E2D;&#x8BFB;&#x53D6;&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x6240;&#x6709;&#x4E0E;topic&#x3001;partition&#x4EE5;&#x53CA;broker&#x6709;&#x5173;&#x7684;&#x4FE1;&#x606F;&#x5E76;&#x8FDB;&#x884C;&#x76F8;&#x5E94;&#x7684;&#x7BA1;&#x7406;&#x3002;&#x5BF9;&#x4E8E;&#x6240;&#x6709;topic&#x6240;&#x5BF9;&#x5E94;&#x7684;Zookeeper&#x4E2D;&#x7684;/brokers/topics/[topic]&#x8282;&#x70B9;&#x6DFB;&#x52A0;PartitionModificationsListener&#xFF0C;&#x7528;&#x6765;&#x76D1;&#x542C;topic&#x4E2D;&#x7684;&#x5206;&#x533A;&#x5206;&#x914D;&#x53D8;&#x5316;&#x3002;</li>
<li>&#x66F4;&#x65B0;&#x96C6;&#x7FA4;&#x7684;&#x5143;&#x6570;&#x636E;&#x4FE1;&#x606F;&#xFF0C;&#x540C;&#x6B65;&#x5230;&#x5176;&#x4ED6;&#x666E;&#x901A;&#x7684;broker&#x8282;&#x70B9;&#x4E2D;&#x3002;</li>
</ol>
<h3 id="13-partition&#x526F;&#x672C;&#x9009;&#x4E3E;leader&#x673A;&#x5236;"><a name="13-partition&#x526F;&#x672C;&#x9009;&#x4E3E;leader&#x673A;&#x5236;" class="anchor-navigation-ex-anchor" href="#13-partition&#x526F;&#x672C;&#x9009;&#x4E3E;leader&#x673A;&#x5236;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="13-partition&#x526F;&#x672C;&#x9009;&#x4E3E;leader&#x673A;&#x5236;" class="plugin-anchor" href="#13-partition&#x526F;&#x672C;&#x9009;&#x4E3E;leader&#x673A;&#x5236;"><i class="fa fa-link" aria-hidden="true"></i></a>1.3 Partition&#x526F;&#x672C;&#x9009;&#x4E3E;Leader&#x673A;&#x5236;</h3>
<p>controller&#x611F;&#x77E5;&#x5230;&#x5206;&#x533A;leader&#x6240;&#x5728;&#x7684;broker&#x6302;&#x4E86;(controller&#x76D1;&#x542C;&#x4E86;&#x5F88;&#x591A;zk&#x8282;&#x70B9;&#x53EF;&#x4EE5;&#x611F;&#x77E5;&#x5230;broker&#x5B58;&#x6D3B;)&#xFF0C;controller&#x4F1A;&#x4ECE;&#x6BCF;&#x4E2A;parititon&#x7684; replicas &#x526F;&#x672C;&#x5217;&#x8868;&#x4E2D;&#x53D6;&#x51FA;&#x7B2C;&#x4E00;&#x4E2A;broker&#x4F5C;&#x4E3A;leader&#xFF0C;&#x5F53;&#x7136;&#x8FD9;&#x4E2A;broker&#x9700;&#x8981;&#x4E5F;&#x540C;&#x65F6;&#x5728;ISR&#x5217;&#x8868;&#x91CC;&#x3002;</p>
<h3 id="14-&#x6D88;&#x8D39;&#x8005;&#x6D88;&#x8D39;&#x6D88;&#x606F;&#x7684;offset&#x8BB0;&#x5F55;&#x673A;&#x5236;"><a name="14-&#x6D88;&#x8D39;&#x8005;&#x6D88;&#x8D39;&#x6D88;&#x606F;&#x7684;offset&#x8BB0;&#x5F55;&#x673A;&#x5236;" class="anchor-navigation-ex-anchor" href="#14-&#x6D88;&#x8D39;&#x8005;&#x6D88;&#x8D39;&#x6D88;&#x606F;&#x7684;offset&#x8BB0;&#x5F55;&#x673A;&#x5236;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="14-&#x6D88;&#x8D39;&#x8005;&#x6D88;&#x8D39;&#x6D88;&#x606F;&#x7684;offset&#x8BB0;&#x5F55;&#x673A;&#x5236;" class="plugin-anchor" href="#14-&#x6D88;&#x8D39;&#x8005;&#x6D88;&#x8D39;&#x6D88;&#x606F;&#x7684;offset&#x8BB0;&#x5F55;&#x673A;&#x5236;"><i class="fa fa-link" aria-hidden="true"></i></a>1.4 &#x6D88;&#x8D39;&#x8005;&#x6D88;&#x8D39;&#x6D88;&#x606F;&#x7684;offset&#x8BB0;&#x5F55;&#x673A;&#x5236;</h3>
<p>&#x6BCF;&#x4E2A;consumer&#x4F1A;&#x5B9A;&#x671F;&#x5C06;&#x81EA;&#x5DF1;&#x6D88;&#x8D39;&#x5206;&#x533A;&#x7684;offset&#x63D0;&#x4EA4;&#x7ED9;kafka&#x5185;&#x90E8;topic&#xFF1A;<strong>__consumer_offsets</strong>&#xFF0C;&#x63D0;&#x4EA4;&#x8FC7;&#x53BB;&#x7684;&#x65F6;&#x5019;&#xFF0C;<strong>key&#x662F;consumerGroupId+topic+&#x5206;&#x533A;&#x53F7;&#xFF0C;value&#x5C31;&#x662F;&#x5F53;&#x524D;offset&#x7684;&#x503C;</strong>&#xFF0C;kafka&#x4F1A;&#x5B9A;&#x671F;&#x6E05;&#x7406;topic&#x91CC;&#x7684;&#x6D88;&#x606F;&#xFF0C;&#x6700;&#x540E;&#x5C31;&#x4FDD;&#x7559;&#x6700;&#x65B0;&#x7684;&#x90A3;&#x6761;&#x6570;&#x636E;</p>
<p> &#x56E0;&#x4E3A;__consumer_offsets&#x53EF;&#x80FD;&#x4F1A;&#x63A5;&#x6536;&#x9AD8;&#x5E76;&#x53D1;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;kafka&#x9ED8;&#x8BA4;&#x7ED9;&#x5176;<strong>&#x5206;&#x914D;50&#x4E2A;&#x5206;&#x533A;</strong>(&#x53EF;&#x4EE5;&#x901A;&#x8FC7;offsets.topic.num.partitions&#x8BBE;&#x7F6E;)&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x52A0;&#x673A;&#x5668;&#x7684;&#x65B9;&#x5F0F;&#x6297;&#x5927;&#x5E76;&#x53D1;&#x3002;</p>
<h1 id="&#x6D88;&#x8D39;&#x8005;rebalance&#x673A;&#x5236;"><a name="&#x6D88;&#x8D39;&#x8005;rebalance&#x673A;&#x5236;" class="anchor-navigation-ex-anchor" href="#&#x6D88;&#x8D39;&#x8005;rebalance&#x673A;&#x5236;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6D88;&#x8D39;&#x8005;rebalance&#x673A;&#x5236;" class="plugin-anchor" href="#&#x6D88;&#x8D39;&#x8005;rebalance&#x673A;&#x5236;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6D88;&#x8D39;&#x8005;Rebalance&#x673A;&#x5236;**</h1>
<p>&#x6D88;&#x8D39;&#x8005;rebalance&#x5C31;&#x662F;&#x8BF4;&#x5982;&#x679C;consumer group&#x4E2D;&#x67D0;&#x4E2A;&#x6D88;&#x8D39;&#x8005;&#x6302;&#x4E86;&#xFF0C;&#x6B64;&#x65F6;&#x4F1A;&#x81EA;&#x52A8;&#x628A;&#x5206;&#x914D;&#x7ED9;&#x4ED6;&#x7684;&#x5206;&#x533A;&#x4EA4;&#x7ED9;&#x5176;&#x4ED6;&#x7684;&#x6D88;&#x8D39;&#x8005;&#xFF0C;&#x5982;&#x679C;&#x4ED6;&#x53C8;&#x91CD;&#x542F;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x53C8;&#x4F1A;&#x628A;&#x4E00;&#x4E9B;&#x5206;&#x533A;&#x91CD;&#x65B0;&#x4EA4;&#x8FD8;&#x7ED9;&#x4ED6;&#x3002;</p>
<p><strong>&#x6CE8;&#x610F;&#xFF1A;</strong>rebalance&#x53EA;&#x9488;&#x5BF9;subscribe&#x8FD9;&#x79CD;&#x4E0D;&#x6307;&#x5B9A;&#x5206;&#x533A;&#x6D88;&#x8D39;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5982;&#x679C;&#x901A;&#x8FC7;assign&#x8FD9;&#x79CD;&#x6D88;&#x8D39;&#x65B9;&#x5F0F;&#x6307;&#x5B9A;&#x4E86;&#x5206;&#x533A;&#xFF0C;kafka&#x4E0D;&#x4F1A;&#x8FDB;&#x884C;rebanlance&#x3002;</p>
<p>&#x5982;&#x4E0B;&#x60C5;&#x51B5;&#x53EF;&#x80FD;&#x4F1A;&#x89E6;&#x53D1;&#x6D88;&#x8D39;&#x8005;rebalance</p>
<ol>
<li>consumer&#x6240;&#x5728;&#x670D;&#x52A1;&#x91CD;&#x542F;&#x6216;&#x5B95;&#x673A;&#x4E86;</li>
<li>&#x52A8;&#x6001;&#x7ED9;topic&#x589E;&#x52A0;&#x4E86;&#x5206;&#x533A;</li>
<li>&#x6D88;&#x8D39;&#x7EC4;&#x8BA2;&#x9605;&#x4E86;&#x66F4;&#x591A;&#x7684;topic</li>
</ol>
<h3 id="15-rebalance"><a name="15-rebalance" class="anchor-navigation-ex-anchor" href="#15-rebalance"><i class="fa fa-link" aria-hidden="true"></i></a><a name="15-rebalance" class="plugin-anchor" href="#15-rebalance"><i class="fa fa-link" aria-hidden="true"></i></a>1.5 Rebalance</h3>
<p>&#x5F53;&#x6709;&#x6D88;&#x8D39;&#x8005;&#x52A0;&#x5165;&#x6D88;&#x8D39;&#x7EC4;&#x65F6;&#xFF0C;&#x6D88;&#x8D39;&#x8005;&#x3001;&#x6D88;&#x8D39;&#x7EC4;&#x53CA;&#x7EC4;&#x534F;&#x8C03;&#x5668;&#x4E4B;&#x95F4;&#x4F1A;&#x7ECF;&#x5386;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#x9636;&#x6BB5;&#x3002;</p>
<h4 id="&#x7B2C;&#x4E00;&#x9636;&#x6BB5;&#xFF1A;&#x9009;&#x62E9;&#x7EC4;&#x534F;&#x8C03;&#x5668;"><a name="&#x7B2C;&#x4E00;&#x9636;&#x6BB5;&#xFF1A;&#x9009;&#x62E9;&#x7EC4;&#x534F;&#x8C03;&#x5668;" class="anchor-navigation-ex-anchor" href="#&#x7B2C;&#x4E00;&#x9636;&#x6BB5;&#xFF1A;&#x9009;&#x62E9;&#x7EC4;&#x534F;&#x8C03;&#x5668;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x7B2C;&#x4E00;&#x9636;&#x6BB5;&#xFF1A;&#x9009;&#x62E9;&#x7EC4;&#x534F;&#x8C03;&#x5668;" class="plugin-anchor" href="#&#x7B2C;&#x4E00;&#x9636;&#x6BB5;&#xFF1A;&#x9009;&#x62E9;&#x7EC4;&#x534F;&#x8C03;&#x5668;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7B2C;&#x4E00;&#x9636;&#x6BB5;&#xFF1A;&#x9009;&#x62E9;&#x7EC4;&#x534F;&#x8C03;&#x5668;</h4>
<p><strong>&#x7EC4;&#x534F;&#x8C03;&#x5668;GroupCoordinator</strong>&#xFF1A;&#x6BCF;&#x4E2A;consumer group&#x90FD;&#x4F1A;&#x9009;&#x62E9;&#x4E00;&#x4E2A;broker&#x4F5C;&#x4E3A;&#x81EA;&#x5DF1;&#x7684;&#x7EC4;&#x534F;&#x8C03;&#x5668;coordinator&#xFF0C;&#x8D1F;&#x8D23;&#x76D1;&#x63A7;&#x8FD9;&#x4E2A;&#x6D88;&#x8D39;&#x7EC4;&#x91CC;&#x7684;&#x6240;&#x6709;&#x6D88;&#x8D39;&#x8005;&#x7684;&#x5FC3;&#x8DF3;&#xFF0C;&#x4EE5;&#x53CA;&#x5224;&#x65AD;&#x662F;&#x5426;&#x5B95;&#x673A;&#xFF0C;&#x7136;&#x540E;&#x5F00;&#x542F;&#x6D88;&#x8D39;&#x8005;rebalance&#x3002;</p>
<p>consumer group&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;consumer&#x542F;&#x52A8;&#x65F6;&#x4F1A;&#x5411;kafka&#x96C6;&#x7FA4;&#x4E2D;&#x7684;&#x67D0;&#x4E2A;&#x8282;&#x70B9;&#x53D1;&#x9001; FindCoordinatorRequest &#x8BF7;&#x6C42;&#x6765;&#x67E5;&#x627E;&#x5BF9;&#x5E94;&#x7684;&#x7EC4;&#x534F;&#x8C03;&#x5668;GroupCoordinator&#xFF0C;&#x5E76;&#x8DDF;&#x5176;&#x5EFA;&#x7ACB;&#x7F51;&#x7EDC;&#x8FDE;&#x63A5;&#x3002;</p>
<p><strong>&#x7EC4;&#x534F;&#x8C03;&#x5668;&#x9009;&#x62E9;&#x65B9;&#x5F0F;</strong>&#xFF1A;</p>
<p>&#x901A;&#x8FC7;&#x5982;&#x4E0B;&#x516C;&#x5F0F;&#x53EF;&#x4EE5;&#x9009;&#x51FA;consumer&#x6D88;&#x8D39;&#x7684;offset&#x8981;&#x63D0;&#x4EA4;&#x5230;__consumer_offsets&#x7684;&#x54EA;&#x4E2A;&#x5206;&#x533A;&#xFF0C;&#x8FD9;&#x4E2A;&#x5206;&#x533A;leader&#x5BF9;&#x5E94;&#x7684;broker&#x5C31;&#x662F;&#x8FD9;&#x4E2A;consumer group&#x7684;coordinator</p>
<p>&#x516C;&#x5F0F;&#xFF1A;<strong>hash(consumer group id) % __consumer_offsets&#x4E3B;&#x9898;&#x7684;&#x5206;&#x533A;&#x6570;</strong></p>
<h4 id="&#x7B2C;&#x4E8C;&#x9636;&#x6BB5;&#xFF1A;&#x52A0;&#x5165;&#x6D88;&#x8D39;&#x7EC4;&#xFF08;join-group&#xFF09;"><a name="&#x7B2C;&#x4E8C;&#x9636;&#x6BB5;&#xFF1A;&#x52A0;&#x5165;&#x6D88;&#x8D39;&#x7EC4;&#xFF08;join-group&#xFF09;" class="anchor-navigation-ex-anchor" href="#&#x7B2C;&#x4E8C;&#x9636;&#x6BB5;&#xFF1A;&#x52A0;&#x5165;&#x6D88;&#x8D39;&#x7EC4;&#xFF08;join-group&#xFF09;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x7B2C;&#x4E8C;&#x9636;&#x6BB5;&#xFF1A;&#x52A0;&#x5165;&#x6D88;&#x8D39;&#x7EC4;&#xFF08;join-group&#xFF09;" class="plugin-anchor" href="#&#x7B2C;&#x4E8C;&#x9636;&#x6BB5;&#xFF1A;&#x52A0;&#x5165;&#x6D88;&#x8D39;&#x7EC4;&#xFF08;join-group&#xFF09;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7B2C;&#x4E8C;&#x9636;&#x6BB5;&#xFF1A;&#x52A0;&#x5165;&#x6D88;&#x8D39;&#x7EC4;&#xFF08;JOIN GROUP&#xFF09;</h4>
<p>&#x5728;&#x6210;&#x529F;&#x627E;&#x5230;&#x6D88;&#x8D39;&#x7EC4;&#x6240;&#x5BF9;&#x5E94;&#x7684; GroupCoordinator &#x4E4B;&#x540E;&#x5C31;&#x8FDB;&#x5165;&#x52A0;&#x5165;&#x6D88;&#x8D39;&#x7EC4;&#x7684;&#x9636;&#x6BB5;&#xFF0C;&#x5728;&#x6B64;&#x9636;&#x6BB5;&#x7684;&#x6D88;&#x8D39;&#x8005;&#x4F1A;&#x5411; GroupCoordinator &#x53D1;&#x9001; JoinGroupRequest &#x8BF7;&#x6C42;&#xFF0C;&#x5E76;&#x5904;&#x7406;&#x54CD;&#x5E94;&#x3002;&#x7136;&#x540E;GroupCoordinator &#x4ECE;&#x4E00;&#x4E2A;consumer group&#x4E2D;&#x9009;&#x62E9;&#x7B2C;&#x4E00;&#x4E2A;&#x52A0;&#x5165;group&#x7684;consumer&#x4F5C;&#x4E3A;leader(<strong>&#x6D88;&#x8D39;&#x7EC4;&#x534F;&#x8C03;&#x5668;</strong>)&#xFF0C;&#x628A;consumer group&#x60C5;&#x51B5;&#x53D1;&#x9001;&#x7ED9;&#x8FD9;&#x4E2A;leader&#xFF0C;&#x63A5;&#x7740;&#x8FD9;&#x4E2A;leader&#x4F1A;&#x8D1F;&#x8D23;&#x5236;&#x5B9A;&#x5206;&#x533A;&#x65B9;&#x6848;&#x3002;</p>
<h4 id="&#x7B2C;&#x4E09;&#x9636;&#x6BB5;&#xFF08;sync-group&#xFF09;"><a name="&#x7B2C;&#x4E09;&#x9636;&#x6BB5;&#xFF08;sync-group&#xFF09;" class="anchor-navigation-ex-anchor" href="#&#x7B2C;&#x4E09;&#x9636;&#x6BB5;&#xFF08;sync-group&#xFF09;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x7B2C;&#x4E09;&#x9636;&#x6BB5;&#xFF08;sync-group&#xFF09;" class="plugin-anchor" href="#&#x7B2C;&#x4E09;&#x9636;&#x6BB5;&#xFF08;sync-group&#xFF09;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7B2C;&#x4E09;&#x9636;&#x6BB5;&#xFF08;SYNC GROUP&#xFF09;</h4>
<p>consumer leader&#x901A;&#x8FC7;&#x7ED9;GroupCoordinator&#x53D1;&#x9001;SyncGroupRequest&#xFF0C;&#x63A5;&#x7740;GroupCoordinator&#x5C31;&#x628A;&#x5206;&#x533A;&#x65B9;&#x6848;&#x4E0B;&#x53D1;&#x7ED9;&#x5404;&#x4E2A;consumer&#xFF0C;&#x4ED6;&#x4EEC;&#x4F1A;&#x6839;&#x636E;&#x6307;&#x5B9A;&#x5206;&#x533A;&#x7684;leader broker&#x8FDB;&#x884C;&#x7F51;&#x7EDC;&#x8FDE;&#x63A5;&#x4EE5;&#x53CA;&#x6D88;&#x606F;&#x6D88;&#x8D39;&#x3002;</p>
<p><img src="../../source/images/ch-06/old/kafka-architecture-02.png" alt="kafka-architecture-02"></p>
<h3 id="16-&#x6D88;&#x8D39;&#x8005;rebalance&#x5206;&#x533A;&#x5206;&#x914D;&#x7B56;&#x7565;"><a name="16-&#x6D88;&#x8D39;&#x8005;rebalance&#x5206;&#x533A;&#x5206;&#x914D;&#x7B56;&#x7565;" class="anchor-navigation-ex-anchor" href="#16-&#x6D88;&#x8D39;&#x8005;rebalance&#x5206;&#x533A;&#x5206;&#x914D;&#x7B56;&#x7565;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="16-&#x6D88;&#x8D39;&#x8005;rebalance&#x5206;&#x533A;&#x5206;&#x914D;&#x7B56;&#x7565;" class="plugin-anchor" href="#16-&#x6D88;&#x8D39;&#x8005;rebalance&#x5206;&#x533A;&#x5206;&#x914D;&#x7B56;&#x7565;"><i class="fa fa-link" aria-hidden="true"></i></a>1.6 &#x6D88;&#x8D39;&#x8005;Rebalance&#x5206;&#x533A;&#x5206;&#x914D;&#x7B56;&#x7565;</h3>
<p>&#x4E3B;&#x8981;&#x6709;&#x4E09;&#x79CD;rebalance&#x7684;&#x7B56;&#x7565;&#xFF1A;range&#x3001;round-robin&#x3001;sticky&#x3002;</p>
<p>Kafka &#x63D0;&#x4F9B;&#x4E86;&#x6D88;&#x8D39;&#x8005;&#x5BA2;&#x6237;&#x7AEF;&#x53C2;&#x6570;partition.assignment.strategy &#x6765;&#x8BBE;&#x7F6E;&#x6D88;&#x8D39;&#x8005;&#x4E0E;&#x8BA2;&#x9605;&#x4E3B;&#x9898;&#x4E4B;&#x95F4;&#x7684;&#x5206;&#x533A;&#x5206;&#x914D;&#x7B56;&#x7565;&#x3002;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E3A;range&#x5206;&#x914D;&#x7B56;&#x7565;&#x3002;</p>
<p>&#x5047;&#x8BBE;&#x4E00;&#x4E2A;&#x4E3B;&#x9898;&#x6709;10&#x4E2A;&#x5206;&#x533A;(0-9)&#xFF0C;&#x73B0;&#x5728;&#x6709;&#x4E09;&#x4E2A;consumer&#x6D88;&#x8D39;&#xFF1A;</p>
<p><strong>range&#x7B56;&#x7565;</strong>&#x5C31;&#x662F;&#x6309;&#x7167;&#x5206;&#x533A;&#x5E8F;&#x53F7;&#x6392;&#x5E8F;&#xFF0C;&#x5047;&#x8BBE; n&#xFF1D;&#x5206;&#x533A;&#x6570;&#xFF0F;&#x6D88;&#x8D39;&#x8005;&#x6570;&#x91CF; = 3&#xFF0C; m&#xFF1D;&#x5206;&#x533A;&#x6570;%&#x6D88;&#x8D39;&#x8005;&#x6570;&#x91CF; = 1&#xFF0C;&#x90A3;&#x4E48;&#x524D; m &#x4E2A;&#x6D88;&#x8D39;&#x8005;&#x6BCF;&#x4E2A;&#x5206;&#x914D; n+1 &#x4E2A;&#x5206;&#x533A;&#xFF0C;&#x540E;&#x9762;&#x7684;&#xFF08;&#x6D88;&#x8D39;&#x8005;&#x6570;&#x91CF;&#xFF0D;m &#xFF09;&#x4E2A;&#x6D88;&#x8D39;&#x8005;&#x6BCF;&#x4E2A;&#x5206;&#x914D; n &#x4E2A;&#x5206;&#x533A;&#x3002;</p>
<p>&#x6BD4;&#x5982;&#x5206;&#x533A;0~3&#x7ED9;&#x4E00;&#x4E2A;consumer&#xFF0C;&#x5206;&#x533A;4~6&#x7ED9;&#x4E00;&#x4E2A;consumer&#xFF0C;&#x5206;&#x533A;7~9&#x7ED9;&#x4E00;&#x4E2A;consumer&#x3002;</p>
<p><strong>round-robin&#x7B56;&#x7565;</strong>&#x5C31;&#x662F;&#x8F6E;&#x8BE2;&#x5206;&#x914D;&#xFF0C;&#x6BD4;&#x5982;&#x5206;&#x533A;0&#x3001;3&#x3001;6&#x3001;9&#x7ED9;&#x4E00;&#x4E2A;consumer&#xFF0C;&#x5206;&#x533A;1&#x3001;4&#x3001;7&#x7ED9;&#x4E00;&#x4E2A;consumer&#xFF0C;&#x5206;&#x533A;2&#x3001;5&#x3001;8&#x7ED9;&#x4E00;&#x4E2A;consumer</p>
<p><strong>sticky&#x7B56;&#x7565;</strong>&#x5C31;&#x662F;&#x5728;rebalance&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9700;&#x8981;&#x4FDD;&#x8BC1;&#x5982;&#x4E0B;&#x4E24;&#x4E2A;&#x539F;&#x5219;&#x3002;</p>
<ul>
<li><p>&#x5206;&#x533A;&#x7684;&#x5206;&#x914D;&#x8981;&#x5C3D;&#x53EF;&#x80FD;&#x5747;&#x5300; &#x3002;</p>
</li>
<li><p>&#x5206;&#x533A;&#x7684;&#x5206;&#x914D;&#x5C3D;&#x53EF;&#x80FD;&#x4E0E;&#x4E0A;&#x6B21;&#x5206;&#x914D;&#x7684;&#x4FDD;&#x6301;&#x76F8;&#x540C;&#x3002;</p>
</li>
</ul>
<p>&#x5F53;&#x4E24;&#x8005;&#x53D1;&#x751F;&#x51B2;&#x7A81;&#x65F6;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x76EE;&#x6807;&#x4F18;&#x5148;&#x4E8E;&#x7B2C;&#x4E8C;&#x4E2A;&#x76EE;&#x6807; &#x3002;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x6700;&#x5927;&#x7A0B;&#x5EA6;&#x7EF4;&#x6301;&#x539F;&#x6765;&#x7684;&#x5206;&#x533A;&#x5206;&#x914D;&#x7684;&#x7B56;&#x7565;&#x3002;</p>
<p>&#x6BD4;&#x5982;&#x5BF9;&#x4E8E;&#x7B2C;&#x4E00;&#x79CD;range&#x60C5;&#x51B5;&#x7684;&#x5206;&#x914D;&#xFF0C;&#x5982;&#x679C;&#x7B2C;&#x4E09;&#x4E2A;consumer&#x6302;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x91CD;&#x65B0;&#x7528;sticky&#x7B56;&#x7565;&#x5206;&#x914D;&#x7684;&#x7ED3;&#x679C;&#x5982;&#x4E0B;&#xFF1A;</p>
<p>consumer1&#x9664;&#x4E86;&#x539F;&#x6709;&#x7684;0~3&#xFF0C;&#x4F1A;&#x518D;&#x5206;&#x914D;&#x4E00;&#x4E2A;7</p>
<p>consumer2&#x9664;&#x4E86;&#x539F;&#x6709;&#x7684;4~6&#xFF0C;&#x4F1A;&#x518D;&#x5206;&#x914D;8&#x548C;9</p>
<h2 id="2-producer&#x53D1;&#x5E03;&#x6D88;&#x606F;&#x673A;&#x5236;&#x5256;&#x6790;"><a name="2-producer&#x53D1;&#x5E03;&#x6D88;&#x606F;&#x673A;&#x5236;&#x5256;&#x6790;" class="anchor-navigation-ex-anchor" href="#2-producer&#x53D1;&#x5E03;&#x6D88;&#x606F;&#x673A;&#x5236;&#x5256;&#x6790;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="2-producer&#x53D1;&#x5E03;&#x6D88;&#x606F;&#x673A;&#x5236;&#x5256;&#x6790;" class="plugin-anchor" href="#2-producer&#x53D1;&#x5E03;&#x6D88;&#x606F;&#x673A;&#x5236;&#x5256;&#x6790;"><i class="fa fa-link" aria-hidden="true"></i></a>2. producer&#x53D1;&#x5E03;&#x6D88;&#x606F;&#x673A;&#x5236;&#x5256;&#x6790;</h2>
<h3 id="21-&#x5199;&#x5165;&#x65B9;&#x5F0F;"><a name="21-&#x5199;&#x5165;&#x65B9;&#x5F0F;" class="anchor-navigation-ex-anchor" href="#21-&#x5199;&#x5165;&#x65B9;&#x5F0F;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="21-&#x5199;&#x5165;&#x65B9;&#x5F0F;" class="plugin-anchor" href="#21-&#x5199;&#x5165;&#x65B9;&#x5F0F;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1 &#x5199;&#x5165;&#x65B9;&#x5F0F;</h3>
<p>producer &#x91C7;&#x7528; push &#x6A21;&#x5F0F;&#x5C06;&#x6D88;&#x606F;&#x53D1;&#x5E03;&#x5230; broker&#xFF0C;&#x6BCF;&#x6761;&#x6D88;&#x606F;&#x90FD;&#x88AB; append &#x5230; patition &#x4E2D;&#xFF0C;&#x5C5E;&#x4E8E;&#x987A;&#x5E8F;&#x5199;&#x78C1;&#x76D8;&#xFF08;&#x987A;&#x5E8F;&#x5199;&#x78C1;&#x76D8;&#x6548;&#x7387;&#x6BD4;&#x968F;&#x673A;&#x5199;&#x5185;&#x5B58;&#x8981;&#x9AD8;&#xFF0C;&#x4FDD;&#x969C; kafka &#x541E;&#x5410;&#x7387;&#xFF09;&#x3002;</p>
<h3 id="22-&#x6D88;&#x606F;&#x8DEF;&#x7531;"><a name="22-&#x6D88;&#x606F;&#x8DEF;&#x7531;" class="anchor-navigation-ex-anchor" href="#22-&#x6D88;&#x606F;&#x8DEF;&#x7531;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="22-&#x6D88;&#x606F;&#x8DEF;&#x7531;" class="plugin-anchor" href="#22-&#x6D88;&#x606F;&#x8DEF;&#x7531;"><i class="fa fa-link" aria-hidden="true"></i></a>2.2 &#x6D88;&#x606F;&#x8DEF;&#x7531;</h3>
<p>producer &#x53D1;&#x9001;&#x6D88;&#x606F;&#x5230; broker &#x65F6;&#xFF0C;&#x4F1A;&#x6839;&#x636E;&#x5206;&#x533A;&#x7B97;&#x6CD5;&#x9009;&#x62E9;&#x5C06;&#x5176;&#x5B58;&#x50A8;&#x5230;&#x54EA;&#x4E00;&#x4E2A; partition&#x3002;&#x5176;&#x8DEF;&#x7531;&#x673A;&#x5236;&#x4E3A;&#xFF1A;</p>
<ul>
<li>&#x6307;&#x5B9A;&#x4E86; patition&#xFF0C;&#x5219;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#xFF1B;</li>
<li>&#x672A;&#x6307;&#x5B9A; patition &#x4F46;&#x6307;&#x5B9A; key&#xFF0C;&#x901A;&#x8FC7;&#x5BF9; key &#x7684; value &#x8FDB;&#x884C;hash &#x9009;&#x51FA;&#x4E00;&#x4E2A; patition</li>
<li>patition &#x548C; key &#x90FD;&#x672A;&#x6307;&#x5B9A;&#xFF0C;&#x4F7F;&#x7528;&#x8F6E;&#x8BE2;&#x9009;&#x51FA;&#x4E00;&#x4E2A; patition&#x3002;</li>
</ul>
<h3 id="23-&#x5199;&#x5165;&#x6D41;&#x7A0B;"><a name="23-&#x5199;&#x5165;&#x6D41;&#x7A0B;" class="anchor-navigation-ex-anchor" href="#23-&#x5199;&#x5165;&#x6D41;&#x7A0B;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="23-&#x5199;&#x5165;&#x6D41;&#x7A0B;" class="plugin-anchor" href="#23-&#x5199;&#x5165;&#x6D41;&#x7A0B;"><i class="fa fa-link" aria-hidden="true"></i></a>2.3 &#x5199;&#x5165;&#x6D41;&#x7A0B;</h3>
<p><img src="../../source/images/ch-06/old/kafka-architecture-03.png" alt="kafka-architecture-03"></p>
<ul>
<li>producer &#x5148;&#x4ECE; zookeeper &#x7684; &quot;/brokers/.../state&quot; &#x8282;&#x70B9;&#x627E;&#x5230;&#x8BE5; partition &#x7684; leader</li>
<li>producer &#x5C06;&#x6D88;&#x606F;&#x53D1;&#x9001;&#x7ED9;&#x8BE5; leader</li>
<li>leader &#x5C06;&#x6D88;&#x606F;&#x5199;&#x5165;&#x672C;&#x5730; log</li>
<li>followers &#x4ECE; leader pull &#x6D88;&#x606F;&#xFF0C;&#x5199;&#x5165;&#x672C;&#x5730; log &#x540E; &#x5411;leader &#x53D1;&#x9001; ACK</li>
<li>leader &#x6536;&#x5230;&#x6240;&#x6709; ISR &#x4E2D;&#x7684; replica &#x7684; ACK &#x540E;&#xFF0C;&#x589E;&#x52A0; HW&#xFF08;high watermark&#xFF0C;&#x6700;&#x540E; commit &#x7684; offset&#xFF09; &#x5E76;&#x5411; producer &#x53D1;&#x9001; ACK</li>
</ul>
<h2 id="3-hw&#x4E0E;leo&#x8BE6;&#x89E3;"><a name="3-hw&#x4E0E;leo&#x8BE6;&#x89E3;" class="anchor-navigation-ex-anchor" href="#3-hw&#x4E0E;leo&#x8BE6;&#x89E3;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="3-hw&#x4E0E;leo&#x8BE6;&#x89E3;" class="plugin-anchor" href="#3-hw&#x4E0E;leo&#x8BE6;&#x89E3;"><i class="fa fa-link" aria-hidden="true"></i></a>3. HW&#x4E0E;LEO&#x8BE6;&#x89E3;</h2>
<p>HW&#x4FD7;&#x79F0;&#x9AD8;&#x6C34;&#x4F4D;&#xFF0C;HighWatermark&#x7684;&#x7F29;&#x5199;&#xFF0C;&#x53D6;&#x4E00;&#x4E2A;partition&#x5BF9;&#x5E94;&#x7684;ISR&#x4E2D;&#x6700;&#x5C0F;&#x7684;LEO(<strong>log-end-offset</strong>)&#x4F5C;&#x4E3A;HW&#xFF0C;consumer&#x6700;&#x591A;&#x53EA;&#x80FD;&#x6D88;&#x8D39;&#x5230;HW&#x6240;&#x5728;&#x7684;&#x4F4D;&#x7F6E;&#x3002;&#x53E6;&#x5916;&#x6BCF;&#x4E2A;replica&#x90FD;&#x6709;HW,leader&#x548C;follower&#x5404;&#x81EA;&#x8D1F;&#x8D23;&#x66F4;&#x65B0;&#x81EA;&#x5DF1;&#x7684;HW&#x7684;&#x72B6;&#x6001;&#x3002;&#x5BF9;&#x4E8E;leader&#x65B0;&#x5199;&#x5165;&#x7684;&#x6D88;&#x606F;&#xFF0C;consumer&#x4E0D;&#x80FD;&#x7ACB;&#x523B;&#x6D88;&#x8D39;&#xFF0C;leader&#x4F1A;&#x7B49;&#x5F85;&#x8BE5;&#x6D88;&#x606F;&#x88AB;&#x6240;&#x6709;ISR&#x4E2D;&#x7684;replicas&#x540C;&#x6B65;&#x540E;&#x66F4;&#x65B0;HW&#xFF0C;&#x6B64;&#x65F6;&#x6D88;&#x606F;&#x624D;&#x80FD;&#x88AB;consumer&#x6D88;&#x8D39;&#x3002;&#x8FD9;&#x6837;&#x5C31;&#x4FDD;&#x8BC1;&#x4E86;&#x5982;&#x679C;leader&#x6240;&#x5728;&#x7684;broker&#x5931;&#x6548;&#xFF0C;&#x8BE5;&#x6D88;&#x606F;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x4ECE;&#x65B0;&#x9009;&#x4E3E;&#x7684;leader&#x4E2D;&#x83B7;&#x53D6;&#x3002;&#x5BF9;&#x4E8E;&#x6765;&#x81EA;&#x5185;&#x90E8;broker&#x7684;&#x8BFB;&#x53D6;&#x8BF7;&#x6C42;&#xFF0C;&#x6CA1;&#x6709;HW&#x7684;&#x9650;&#x5236;&#x3002;</p>
<p>&#x4E0B;&#x56FE;&#x8BE6;&#x7EC6;&#x7684;&#x8BF4;&#x660E;&#x4E86;&#x5F53;producer&#x751F;&#x4EA7;&#x6D88;&#x606F;&#x81F3;broker&#x540E;&#xFF0C;ISR&#x4EE5;&#x53CA;HW&#x548C;LEO&#x7684;&#x6D41;&#x8F6C;&#x8FC7;&#x7A0B;&#xFF1A;</p>
<p><img src="../../source/images/ch-06/old/kafka-architecture-04.png" alt="kafka-architecture-04"></p>
<p>&#x7531;&#x6B64;&#x53EF;&#x89C1;&#xFF0C;Kafka&#x7684;&#x590D;&#x5236;&#x673A;&#x5236;&#x65E2;&#x4E0D;&#x662F;&#x5B8C;&#x5168;&#x7684;&#x540C;&#x6B65;&#x590D;&#x5236;&#xFF0C;&#x4E5F;&#x4E0D;&#x662F;&#x5355;&#x7EAF;&#x7684;&#x5F02;&#x6B65;&#x590D;&#x5236;&#x3002;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;&#x540C;&#x6B65;&#x590D;&#x5236;&#x8981;&#x6C42;&#x6240;&#x6709;&#x80FD;&#x5DE5;&#x4F5C;&#x7684;follower&#x90FD;&#x590D;&#x5236;&#x5B8C;&#xFF0C;&#x8FD9;&#x6761;&#x6D88;&#x606F;&#x624D;&#x4F1A;&#x88AB;commit&#xFF0C;&#x8FD9;&#x79CD;&#x590D;&#x5236;&#x65B9;&#x5F0F;&#x6781;&#x5927;&#x7684;&#x5F71;&#x54CD;&#x4E86;&#x541E;&#x5410;&#x7387;&#x3002;&#x800C;&#x5F02;&#x6B65;&#x590D;&#x5236;&#x65B9;&#x5F0F;&#x4E0B;&#xFF0C;follower&#x5F02;&#x6B65;&#x7684;&#x4ECE;leader&#x590D;&#x5236;&#x6570;&#x636E;&#xFF0C;&#x6570;&#x636E;&#x53EA;&#x8981;&#x88AB;leader&#x5199;&#x5165;log&#x5C31;&#x88AB;&#x8BA4;&#x4E3A;&#x5DF2;&#x7ECF;commit&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x5982;&#x679C;follower&#x90FD;&#x8FD8;&#x6CA1;&#x6709;&#x590D;&#x5236;&#x5B8C;&#xFF0C;&#x843D;&#x540E;&#x4E8E;leader&#x65F6;&#xFF0C;&#x7A81;&#x7136;leader&#x5B95;&#x673A;&#xFF0C;&#x5219;&#x4F1A;&#x4E22;&#x5931;&#x6570;&#x636E;&#x3002;&#x800C;Kafka&#x7684;&#x8FD9;&#x79CD;&#x4F7F;&#x7528;ISR&#x7684;&#x65B9;&#x5F0F;&#x5219;&#x5F88;&#x597D;&#x7684;&#x5747;&#x8861;&#x4E86;&#x786E;&#x4FDD;&#x6570;&#x636E;&#x4E0D;&#x4E22;&#x5931;&#x4EE5;&#x53CA;&#x541E;&#x5410;&#x7387;&#x3002;&#x518D;&#x56DE;&#x987E;&#x4E0B;&#x6D88;&#x606F;&#x53D1;&#x9001;&#x7AEF;&#x5BF9;&#x53D1;&#x51FA;&#x6D88;&#x606F;&#x6301;&#x4E45;&#x5316;&#x673A;&#x5236;&#x53C2;&#x6570;acks&#x7684;&#x8BBE;&#x7F6E;&#xFF0C;&#x6211;&#x4EEC;&#x7ED3;&#x5408;HW&#x548C;LEO&#x6765;&#x770B;&#x4E0B;acks=1&#x7684;&#x60C5;&#x51B5;</p>
<p><strong>&#x7ED3;&#x5408;HW&#x548C;LEO&#x770B;&#x4E0B; acks=1&#x7684;&#x60C5;&#x51B5;</strong></p>
<p><img src="../../source/images/ch-06/old/kafka-architecture-05.png" alt="kafka-architecture-05"></p>
<h2 id="4-&#x65E5;&#x5FD7;&#x5206;&#x6BB5;&#x5B58;&#x50A8;"><a name="4-&#x65E5;&#x5FD7;&#x5206;&#x6BB5;&#x5B58;&#x50A8;" class="anchor-navigation-ex-anchor" href="#4-&#x65E5;&#x5FD7;&#x5206;&#x6BB5;&#x5B58;&#x50A8;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="4-&#x65E5;&#x5FD7;&#x5206;&#x6BB5;&#x5B58;&#x50A8;" class="plugin-anchor" href="#4-&#x65E5;&#x5FD7;&#x5206;&#x6BB5;&#x5B58;&#x50A8;"><i class="fa fa-link" aria-hidden="true"></i></a>4. &#x65E5;&#x5FD7;&#x5206;&#x6BB5;&#x5B58;&#x50A8;</h2>
<p>Kafka &#x4E00;&#x4E2A;&#x5206;&#x533A;&#x7684;&#x6D88;&#x606F;&#x6570;&#x636E;&#x5BF9;&#x5E94;&#x5B58;&#x50A8;&#x5728;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x5939;&#x4E0B;&#xFF0C;&#x4EE5;topic&#x540D;&#x79F0;+&#x5206;&#x533A;&#x53F7;&#x547D;&#x540D;&#xFF0C;kafka&#x89C4;&#x5B9A;&#x4E86;&#x4E00;&#x4E2A;&#x5206;&#x533A;&#x5185;&#x7684; .log &#x6587;&#x4EF6;&#x6700;&#x5927;&#x4E3A; 1G&#xFF0C;&#x505A;&#x8FD9;&#x4E2A;&#x9650;&#x5236;&#x76EE;&#x7684;&#x662F;&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x628A; .log &#x52A0;&#x8F7D;&#x5230;&#x5185;&#x5B58;&#x53BB;&#x64CD;&#x4F5C;&#xFF1A;</p>
<pre><code># &#x90E8;&#x5206;&#x6D88;&#x606F;&#x7684;offset&#x7D22;&#x5F15;&#x6587;&#x4EF6;&#xFF0C;kafka&#x6BCF;&#x6B21;&#x5F80;&#x5206;&#x533A;&#x53D1;4K(&#x53EF;&#x914D;&#x7F6E;)&#x6D88;&#x606F;&#x5C31;&#x4F1A;&#x8BB0;&#x5F55;&#x4E00;&#x6761;&#x5F53;&#x524D;&#x6D88;&#x606F;&#x7684;offset&#x5230;index&#x6587;&#x4EF6;&#xFF0C;
# &#x5982;&#x679C;&#x8981;&#x5B9A;&#x4F4D;&#x6D88;&#x606F;&#x7684;offset&#x4F1A;&#x5148;&#x5728;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x91CC;&#x5FEB;&#x901F;&#x5B9A;&#x4F4D;&#xFF0C;&#x518D;&#x53BB;log&#x6587;&#x4EF6;&#x91CC;&#x627E;&#x5177;&#x4F53;&#x6D88;&#x606F;
00000000000000000000.index
# &#x6D88;&#x606F;&#x5B58;&#x50A8;&#x6587;&#x4EF6;&#xFF0C;&#x4E3B;&#x8981;&#x5B58;offset&#x548C;&#x6D88;&#x606F;&#x4F53;
00000000000000000000.log
# &#x6D88;&#x606F;&#x7684;&#x53D1;&#x9001;&#x65F6;&#x95F4;&#x7D22;&#x5F15;&#x6587;&#x4EF6;&#xFF0C;kafka&#x6BCF;&#x6B21;&#x5F80;&#x5206;&#x533A;&#x53D1;4K(&#x53EF;&#x914D;&#x7F6E;)&#x6D88;&#x606F;&#x5C31;&#x4F1A;&#x8BB0;&#x5F55;&#x4E00;&#x6761;&#x5F53;&#x524D;&#x6D88;&#x606F;&#x7684;&#x53D1;&#x9001;&#x65F6;&#x95F4;&#x6233;&#x4E0E;&#x5BF9;&#x5E94;&#x7684;offset&#x5230;timeindex&#x6587;&#x4EF6;&#xFF0C;
# &#x5982;&#x679C;&#x9700;&#x8981;&#x6309;&#x7167;&#x65F6;&#x95F4;&#x6765;&#x5B9A;&#x4F4D;&#x6D88;&#x606F;&#x7684;offset&#xFF0C;&#x4F1A;&#x5148;&#x5728;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x91CC;&#x67E5;&#x627E;
00000000000000000000.timeindex

00000000000005367851.index
00000000000005367851.log
00000000000005367851.timeindex

00000000000009936472.index
00000000000009936472.log
00000000000009936472.timeindex
</code></pre><p>&#x8FD9;&#x4E2A; 9936472 &#x4E4B;&#x7C7B;&#x7684;&#x6570;&#x5B57;&#xFF0C;&#x5C31;&#x662F;&#x4EE3;&#x8868;&#x4E86;&#x8FD9;&#x4E2A;&#x65E5;&#x5FD7;&#x6BB5;&#x6587;&#x4EF6;&#x91CC;&#x5305;&#x542B;&#x7684;&#x8D77;&#x59CB; Offset&#xFF0C;&#x4E5F;&#x5C31;&#x8BF4;&#x660E;&#x8FD9;&#x4E2A;&#x5206;&#x533A;&#x91CC;&#x81F3;&#x5C11;&#x90FD;&#x5199;&#x5165;&#x4E86;&#x63A5;&#x8FD1; 1000 &#x4E07;&#x6761;&#x6570;&#x636E;&#x4E86;&#x3002;</p>
<p>Kafka Broker &#x6709;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;log.segment.bytes&#xFF0C;&#x9650;&#x5B9A;&#x4E86;&#x6BCF;&#x4E2A;&#x65E5;&#x5FD7;&#x6BB5;&#x6587;&#x4EF6;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x6700;&#x5927;&#x5C31;&#x662F; 1GB&#x3002;</p>
<p>&#x4E00;&#x4E2A;&#x65E5;&#x5FD7;&#x6BB5;&#x6587;&#x4EF6;&#x6EE1;&#x4E86;&#xFF0C;&#x5C31;&#x81EA;&#x52A8;&#x5F00;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x65E5;&#x5FD7;&#x6BB5;&#x6587;&#x4EF6;&#x6765;&#x5199;&#x5165;&#xFF0C;&#x907F;&#x514D;&#x5355;&#x4E2A;&#x6587;&#x4EF6;&#x8FC7;&#x5927;&#xFF0C;&#x5F71;&#x54CD;&#x6587;&#x4EF6;&#x7684;&#x8BFB;&#x5199;&#x6027;&#x80FD;&#xFF0C;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x53EB;&#x505A; log rolling&#xFF0C;&#x6B63;&#x5728;&#x88AB;&#x5199;&#x5165;&#x7684;&#x90A3;&#x4E2A;&#x65E5;&#x5FD7;&#x6BB5;&#x6587;&#x4EF6;&#xFF0C;&#x53EB;&#x505A; active log segment&#x3002;</p>
<h2 id="5-zookeeper&#x8282;&#x70B9;&#x6570;&#x636E;&#x56FE;"><a name="5-zookeeper&#x8282;&#x70B9;&#x6570;&#x636E;&#x56FE;" class="anchor-navigation-ex-anchor" href="#5-zookeeper&#x8282;&#x70B9;&#x6570;&#x636E;&#x56FE;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="5-zookeeper&#x8282;&#x70B9;&#x6570;&#x636E;&#x56FE;" class="plugin-anchor" href="#5-zookeeper&#x8282;&#x70B9;&#x6570;&#x636E;&#x56FE;"><i class="fa fa-link" aria-hidden="true"></i></a>5. zookeeper&#x8282;&#x70B9;&#x6570;&#x636E;&#x56FE;</h2>
<p><img src="../../source/images/ch-06/old/kafka-architecture-06.png" alt="kafka-architecture-06"></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="25-Kafka-Cluster.html" class="navigation navigation-prev " aria-label="Previous page: 25 Kafka集群搭建与使用">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="27-Kafka-Optimizer-Training.html" class="navigation navigation-next " aria-label="Next page: 27 Kafka性能优化实战">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"26 Kafka设计原理详解","level":"1.1.6.23","depth":3,"next":{"title":"27 Kafka性能优化实战","level":"1.1.6.24","depth":3,"path":"06-Distributed/Old/27-Kafka-Optimizer-Training.md","ref":"06-Distributed/Old/27-Kafka-Optimizer-Training.md","articles":[]},"previous":{"title":"25 Kafka集群搭建与使用","level":"1.1.6.22","depth":3,"path":"06-Distributed/Old/25-Kafka-Cluster.md","ref":"06-Distributed/Old/25-Kafka-Cluster.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-sharing","splitter","expandable-chapters-small","anchors","github","github-buttons","sharing-plus","anchor-navigation-ex"],"styles":{"website":"./styles/website.css"},"pluginsConfig":{"github":{"url":"https://github.com/tyrival"},"splitter":{},"search":{},"sharing-plus":{"qq":false,"all":["facebook","google","twitter","instapaper","linkedin","pocket","stumbleupon"],"douban":false,"facebook":true,"weibo":false,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"pocket":true,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"anchor-navigation-ex":{"associatedWithSummary":true,"float":{"floatIcon":"fa fa-navicon","level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"mode":"float","multipleH1":true,"pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"printLog":false,"showGoTop":true,"showLevel":false},"github-buttons":{"buttons":[{"user":"Tyrival","repo":"gitbook","type":"star","size":"small","count":false}]},"expandable-chapters-small":{},"sharing":{"qq":false,"all":["google","facebook","weibo","twitter","qq","qzone","linkedin","pocket"],"douban":false,"facebook":false,"weibo":false,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":false,"messenger":false,"line":false,"vk":false,"pocket":false,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"anchors":{}},"theme":"default","author":"Tyrival","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"架构师学习笔记","language":"zh-hans","gitbook":"3.2.3","description":"架构师学习笔记"},"file":{"path":"06-Distributed/Old/26-Kafka-Architecture.md","mtime":"2020-09-08T13:23:54.629Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-10-14T08:32:43.954Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-github-buttons/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing-plus/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

